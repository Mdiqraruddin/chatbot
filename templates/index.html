<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Medical Assistant — Chat</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#f6f9fc; --card:#ffffff; --accent:#0b74de;
      --user:#daf1ff; --bot:#e9ffe9; --muted:#666;
    }
    body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);display:flex;align-items:center;justify-content:center;height:100vh}
    .app{width:100%;max-width:820px;background:linear-gradient(180deg,#fff 0%, #fbfdff 100%);box-shadow:0 8px 30px rgba(2,6,23,0.08);border-radius:12px;overflow:hidden;display:flex;flex-direction:column}
    header{padding:18px 20px;border-bottom:1px solid #eef3f8;display:flex;align-items:center;gap:12px}
    header h1{font-size:18px;margin:0}
    .container{display:flex;gap:18px;padding:18px}
    .left{flex:1;display:flex;flex-direction:column;height:60vh}
    .chat{flex:1;background:var(--card);border-radius:8px;padding:16px;overflow:auto;box-shadow:inset 0 1px 0 rgba(0,0,0,0.02)}
    .inputRow{display:flex;gap:8px;margin-top:10px}
    input[type="text"]{flex:1;padding:12px;border-radius:8px;border:1px solid #e6eef7}
    button{background:var(--accent);color:#fff;border:0;padding:10px 14px;border-radius:8px;cursor:pointer}
    .bubble{max-width:78%;padding:10px 12px;border-radius:12px;margin:8px 0;white-space:pre-wrap}
    .user{align-self:flex-end;background:var(--user)}
    .bot{align-self:flex-start;background:var(--bot)}
    .meta{font-size:12px;color:var(--muted);margin-top:6px}
    .right{width:320px}
    .card{background:var(--card);padding:12px;border-radius:8px;box-shadow:0 1px 0 rgba(0,0,0,0.03);margin-bottom:12px}
    .small{font-size:13px;color:var(--muted)}
    .src{font-size:13px;margin-top:8px;color:#074;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    footer{padding:12px;border-top:1px solid #eef3f8;font-size:13px;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <img src="" alt="" style="width:40px;height:40px;border-radius:8px;background:linear-gradient(90deg,#0b74de,#2fc4ff)"/>
      <div>
        <h1>Medical Assistant</h1>
        <div class="small">General info only • Not a substitute for professional medical advice</div>
      </div>
    </header>

    <div class="container">
      <div class="left">
        <div id="chat" class="chat"></div>

        <div class="inputRow">
          <input id="message" placeholder="Type symptoms or question (e.g., 'fever, cough')"/>
          <button id="symBtn">Symptom-check</button>
          <button id="sendBtn">Send</button>
        </div>
        <div class="meta" id="disclaimer"></div>
      </div>

      <div class="right">
        <div class="card">
          <div style="font-weight:600">Session History</div>
          <div id="history" class="small" style="margin-top:8px;max-height:260px;overflow:auto"></div>
        </div>

        <div class="card">
          <div style="font-weight:600">Quick tips</div>
          <div class="small" style="margin-top:8px">
            • For a multi-symptom check, click <b>Symptom-check</b> after typing symptoms separated by commas.<br>
            • In emergencies (chest pain, severe breathing trouble) call emergency services immediately.
          </div>
        </div>
      </div>
    </div>

    <footer>Answers are informational only — not a medical diagnosis.</footer>
  </div>

<script>
const chatEl = document.getElementById('chat');
const histEl = document.getElementById('history');
const msgInput = document.getElementById('message');
const sendBtn = document.getElementById('sendBtn');
const symBtn = document.getElementById('symBtn');
const disclaimer = document.getElementById('disclaimer');

function addBubble(text, who='bot'){
  const d = document.createElement('div');
  d.className = 'bubble ' + (who==='user' ? 'user':'bot');
  d.textContent = text;
  chatEl.appendChild(d);
  chatEl.scrollTop = chatEl.scrollHeight;
}
function refreshHistory(history){
  histEl.innerHTML = '';
  history.slice().reverse().forEach(h=>{
    const el = document.createElement('div');
    el.innerHTML = `<b>You:</b> ${h.user} <br><b>Bot:</b> ${h.bot}<hr>`;
    histEl.appendChild(el);
  });
}

async function send(symptom_mode=false){
  const text = msgInput.value.trim();
  if(!text) return;
  addBubble(text,'user');
  msgInput.value = '';
  try{
    const res = await fetch('/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({message: text, symptom_mode: symptom_mode})
    });
    if(!res.ok){
      const body = await res.text();
      addBubble('Server error (see console).');
      console.error('Server responded', res.status, body);
      return;
    }
    const data = await res.json();
    addBubble(data.reply || 'No reply');
    if(data.history) refreshHistory(data.history);
    if(data.disclaimer) disclaimer.textContent = data.disclaimer;
  } catch(e){
    console.error(e);
    addBubble('Network or server error. Check server console.');
  }
}

sendBtn.onclick = ()=> send(false);
symBtn.onclick = ()=> send(true);
msgInput.addEventListener('keydown', (e)=> { if(e.key === 'Enter') send(false); });

// initial greeting
addBubble("Hello — I can provide general info on common symptoms and suggest non-prescription options. For emergencies call local services immediately.");
</script>
</body>
</html>
